<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tom Linl&#39;s Blog</title>
  
  <subtitle>o(*￣▽￣*)ブ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-05-27T11:26:38.124Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Tom Linl</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PHP第三方登录—OAuth2.0协议</title>
    <link href="http://yoursite.com/2018/05/01/OAuth/"/>
    <id>http://yoursite.com/2018/05/01/OAuth/</id>
    <published>2018-05-01T14:32:36.000Z</published>
    <updated>2018-05-27T11:26:38.124Z</updated>
    
    <content type="html"><![CDATA[<p>OAuth 是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。目前，OAuth 的最新版本为 2.0<br><a id="more"></a></p><p>OAuth 允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的网站（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth 允许用户授权第三方网站访问他们存储在另外的服务提供者上的信息，而不需要分享他们的访问许可或他们数据的所有内容。</p><p>OAuth授权流程<br>1.请求OAuth登陆页<br>Request Token URL - 未授权的令牌请求服务地址<br>2.用户使用第三方账号登陆并授权<br>3.返回登陆结果<br>User Authorization URL - 用户授权的令牌请求服务地址<br>AccessToken - 用户通过第三方应用访问OAuth接口令牌</p><p>新浪微博登陆 (<a href="http://open.weibo.com" target="_blank" rel="noopener">http://open.weibo.com</a>)<br>1.申请AppID和AppKey<br>2.下载PHP版本SDK<br>3.接入开发</p><p>QQ登陆 (<a href="http://connect.qq.com" target="_blank" rel="noopener">http://connect.qq.com</a>)<br>1.申请AppID和AppKey<br>2.下载PHP版本SDK<br>3.SDK配置<br>4.接入开发</p><p>以微博登陆为例：<br>config.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define(&apos;WB_KEY&apos;,&apos;获取的AppKey&apos;);</span><br><span class="line">define(&apos;WB_SRC&apos;,&apos;获取的AppSecret&apos;);</span><br><span class="line">define(&apos;CALLBACK&apos;,&apos;回调地址(callback.php)&apos;);</span><br></pre></td></tr></table></figure></p><p>wblogin.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require_once &apos;config.php&apos;;</span><br><span class="line">require_once &apos;saetv2.ex.class.php&apos;;</span><br><span class="line">$o = new SaeTOAuthV2(&apos;WB_KEY&apos;,&apos;WB_SRC&apos;);</span><br><span class="line">$url = CALLBACK；</span><br><span class="line">$oauth = $o-&gt;getAuthorizeUrl($url);</span><br><span class="line">header(&apos;Location: &apos;.$oauth);</span><br></pre></td></tr></table></figure></p><p>callback.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require_once &apos;config.php&apos;;</span><br><span class="line">require_once &apos;saetv2.ex.class.php&apos;;</span><br><span class="line">$code = $_GET(&apos;code&apos;);</span><br><span class="line">$keys[&apos;code&apos;] = $code;</span><br><span class="line">$keys[&apos;redirect_uri&apos;] = CALLBACK;</span><br><span class="line">$o = new SaeTOAuthV2(&apos;WB_KEY&apos;,&apos;WB_SRC&apos;);</span><br><span class="line">$auth = $o-&gt;getAccessToken($keys);</span><br><span class="line">setcookie(&apos;accesstoken&apos;,$auth[&apos;access_token&apos;],time()+86400);</span><br><span class="line">header(&apos;location: index.php&apos;);</span><br></pre></td></tr></table></figure></p><p>index.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">     equire_once &apos;config.php&apos;;</span><br><span class="line">     require_once &apos;saetv2.ex.class.php&apos;;</span><br><span class="line">    $isLogin=isset($_COOKIE[&apos;accesstoken&apos;]);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">     &lt;head&gt;</span><br><span class="line">          &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">          &lt;title&gt;微博测试&lt;/title&gt;</span><br><span class="line">     &lt;/head&gt;</span><br><span class="line">     &lt;body&gt;</span><br><span class="line">          &lt;?php if(!$isLogin)&#123; ?&gt;</span><br><span class="line">               &lt;a href=&apos;wblogin.php&apos;&gt;&lt;img src=&apos;./weibo_login.png&apos;&gt;&lt;/a&gt;</span><br><span class="line">          &lt;?php &#125;else&#123; ?&gt;</span><br><span class="line">              您已成功登陆微博账号；</span><br><span class="line">          &lt;?php</span><br><span class="line">             $o = new SaeTClientV2(&apos;WB_KEY&apos;,&apos;WB_SRC&apos;,$_COOKIE[&apos;accesstoken&apos;]);     //调用接口发布微博</span><br><span class="line">             $o-&gt;update(&apos;发布微博&apos;);</span><br><span class="line">          &#125; ?&gt;</span><br><span class="line">     &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>debug调试方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function debug($val,$dump = false,$exit = true) &#123;</span><br><span class="line">    //自动获取函数名称$func</span><br><span class="line">    if($dump)&#123;</span><br><span class="line">          $func = &apos;var_dump&apos;;</span><br><span class="line">     &#125; else &#123;</span><br><span class="line">          $func = (is_array($val) || is_object($val) )? &apos;print_r&apos; : &apos;printf&apos;;</span><br><span class="line">     &#125;</span><br><span class="line">    header(&quot;Content-type: text/html; charset = utf-8&quot;);</span><br><span class="line">    echo &apos;&lt;pre&gt;debug output:&lt;hr /&gt;&apos;;</span><br><span class="line">    $func($val);</span><br><span class="line">    echo &apos;&lt;/pre&gt;&apos;;</span><br><span class="line">    if($exit); exit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;OAuth 是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。目前，OAuth 的最新版本为 2.0&lt;br&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="OAuth2.0" scheme="http://yoursite.com/tags/OAuth2-0/"/>
    
  </entry>
  
  <entry>
    <title>PHP实现文件上传与下载</title>
    <link href="http://yoursite.com/2018/05/01/setdoc/"/>
    <id>http://yoursite.com/2018/05/01/setdoc/</id>
    <published>2018-05-01T14:18:17.000Z</published>
    <updated>2018-05-01T14:36:44.069Z</updated>
    
    <content type="html"><![CDATA[<p>文件上传原理：将客户端的文件上传到服务器端，再将服务器端的临时文件移动到指定目录即可。<br><a id="more"></a></p><h4 id="客户端配置："><a href="#客户端配置：" class="headerlink" title="客户端配置："></a>客户端配置：</h4><p>表单页面<br>表单发送方式为 post<br>添加 enctype=”multipart/form-data”</p><p>通过使用 PHP 的全局数组 $_FILES，你可以从客户计算机向远程服务器上传文件。</p><p>第一个参数是表单的 input name，第二个下标可以是 “name”, “type”, “size”, “tmp_name” 或 “error”。就像这样：</p><p>$_FILES[“file”][“name”] - 被上传文件的名称<br>$_FILES[“file”][“type”] - 被上传文件的类型<br>$_FILES[“file”][“size”] - 被上传文件的大小，以字节计<br>$_FILES[“file”][“tmp_name”] - 存储在服务器的文件的临时副本的名称<br>$_FILES[“file”][“error”] - 由文件上传导致的错误代码</p><p>move_uploaded_file() 函数将上传的文件移动到新位置。</p><p>若成功，则返回 true，否则返回 false。</p><p>move_uploaded_file(file,newloc)</p><p>将文件从 source 拷贝到 destination。如果成功则返回 TRUE，否则返回 FALSE。<br>copy(source,destination)</p><h4 id="文件上传配置"><a href="#文件上传配置" class="headerlink" title="文件上传配置"></a>文件上传配置</h4><p>file_uploads=on,支持HTTP上传<br>upload_tmp_dir=,临时文件保存的目录<br>upload_max_filesize=2M,允许上传文件的最大值<br>max_file_uploads=20,允许文件上传的最大文件数<br>post_max_size=8M,POST方式发送数据的最大值<br>max_execution_time=-1,设置了脚本被解析器终止之前允许的最大执行时间，单位为秒，防止程序写的不好而占尽服务器资源<br>max_input_time=60,脚本解析输入数据允许的最大时间，单位为秒<br>max_input_nesting_level=64,设置输入变量的嵌套深度<br>max_input_vars=1000,接受多少输入的变量（限制分别应用于$_GET、$_POST和$_COOKIE超全局变量）指令的使用减轻了以哈希碰撞来进行拒绝服务器攻击的可能性。如果有超过指令指定数量的变量，将会导致$_WARNING的产生，更多的输入变量将会从请求中截断。<br>memory_limit=128M,最大单线程的独立内存使用量。也就是一个web请求，给予线程最大使用量的定义。</p><h4 id="错误信息说明"><a href="#错误信息说明" class="headerlink" title="错误信息说明"></a>错误信息说明</h4><p>1、UPLOAD_ERR_OK</p><p>其值为 0，没有错误发生，文件上传成功。</p><p>2、UPLOAD_ERR_INI_SIZE</p><p>其值为 1，上传的文件超过了 php.ini 中 upload_max_filesize选项限制的值。</p><p>3、UPLOAD_ERR_FORM_SIZE</p><p>其值为 2，上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值。</p><p>4、UPLOAD_ERR_PARTIAL</p><p>其值为 3，文件只有部分被上传。</p><p>5、UPLOAD_ERR_NO_FILE</p><p>其值为 4，没有文件被上传。</p><p>6、UPLOAD_ERR_NO_TMP_DIR</p><p>其值为 6，找不到临时文件夹。PHP 4.3.10 和 PHP 5.0.3 引进。</p><p>7、UPLOAD_ERR_CANT_WRITE</p><p>其值为 7，文件写入失败。PHP 5.1.0 引进。</p><p>8、UPLOAD_ERR_EXTENSION</p><p>其值为 8，上传的文件被PHP扩展程序中断</p><h4 id="上传文件限制"><a href="#上传文件限制" class="headerlink" title="上传文件限制"></a>上传文件限制</h4><p>通过表单隐藏域限制文件上传的最大值<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type="hidden" name='MAX_FILE_SIZE' value='字节数' /&gt;</span><br></pre></td></tr></table></figure></p><p>通过accept属性限制上传文件类型<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span> accept=<span class="string">"文件的MIME类型"</span> /&gt;</span><br></pre></td></tr></table></figure></p><p>（ps:表单限制不可靠）<br>服务器限制<br>限制文件上传的大小、类型、检测类型、检测是否为HTTP POST方式上传</p><h4 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$filename=$_GET['filename'];</span><br><span class="line">header('Content-Disposition:attachment;filename='.$filename);</span><br><span class="line">header(<span class="string">"Content-length:"</span>.filesize($filename));</span><br><span class="line">readfile($filename);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;文件上传原理：将客户端的文件上传到服务器端，再将服务器端的临时文件移动到指定目录即可。&lt;br&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>layui-Ajax分页</title>
    <link href="http://yoursite.com/2018/04/10/layui-page/"/>
    <id>http://yoursite.com/2018/04/10/layui-page/</id>
    <published>2018-04-09T16:20:28.000Z</published>
    <updated>2018-04-09T16:46:07.480Z</updated>
    
    <content type="html"><![CDATA[<p>layPage 致力于提供极致的分页逻辑，既可轻松胜任异步分页，也可作为页面刷新式分页。下面是使用layui分页控件实现异步请求分页操作的实现方法。<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入组件js和css</span></span><br><span class="line">&lt;script src=<span class="string">"__STATIC__/layui/layui.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"__STATIC__/layui/css/layui.css"</span>&gt;</span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">'请求地址'</span></span><br><span class="line">        <span class="keyword">var</span> data = &#123;&#125;;</span><br><span class="line">        data.page = <span class="number">1</span>;</span><br><span class="line">        ajax(data);</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="string">"post"</span>,</span><br><span class="line">                url: url,</span><br><span class="line">                data: data,</span><br><span class="line">                success: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> res = result.data;</span><br><span class="line">                    <span class="keyword">var</span> count = result.count;</span><br><span class="line">                    <span class="keyword">var</span> page = result.page;</span><br><span class="line">                    <span class="keyword">var</span> limit = result.limit;</span><br><span class="line">                    <span class="built_in">console</span>.log(res); <span class="comment">//查看服务器返回的数据</span></span><br><span class="line">                    <span class="keyword">if</span>(count&gt;limit)&#123;</span><br><span class="line">                        lay_page(count,limit,page);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">lay_page</span>(<span class="params">count,limit,page</span>) </span>&#123;</span><br><span class="line">            layui.use([<span class="string">'laypage'</span>, <span class="string">'layer'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> laypage = layui.laypage</span><br><span class="line">                        , layer = layui.layer;</span><br><span class="line">                laypage.render(&#123;</span><br><span class="line">                    elem: <span class="string">'指向存放分页的容器，值可以是容器ID、DOM对象'</span></span><br><span class="line">                    , <span class="attr">count</span>: count <span class="comment">//数据总数，从服务端得到</span></span><br><span class="line">                    , <span class="attr">limit</span>: limit <span class="comment">//每页显示的条数</span></span><br><span class="line">                    , <span class="attr">curr</span>: page</span><br><span class="line">                    , <span class="attr">jump</span>: <span class="function"><span class="keyword">function</span> (<span class="params">obj, first</span>) </span>&#123;</span><br><span class="line">                        <span class="comment">//obj包含了当前分页的所有参数，比如：</span></span><br><span class="line">                        <span class="comment">//console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。</span></span><br><span class="line">                        <span class="comment">//console.log(obj.limit); //得到每页显示的条数</span></span><br><span class="line">                        <span class="comment">//首次不执行</span></span><br><span class="line">                        <span class="keyword">if</span> (!first) &#123;</span><br><span class="line">                            data.page=obj.curr;</span><br><span class="line">                            ajax(data);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;layPage 致力于提供极致的分页逻辑，既可轻松胜任异步分页，也可作为页面刷新式分页。下面是使用layui分页控件实现异步请求分页操作的实现方法。&lt;br&gt;
    
    </summary>
    
    
      <category term="layui" scheme="http://yoursite.com/tags/layui/"/>
    
      <category term="Ajax" scheme="http://yoursite.com/tags/Ajax/"/>
    
  </entry>
  
  <entry>
    <title>支付宝手机网站支付(PHP)</title>
    <link href="http://yoursite.com/2018/04/07/alipay-wap/"/>
    <id>http://yoursite.com/2018/04/07/alipay-wap/</id>
    <published>2018-04-07T14:29:02.000Z</published>
    <updated>2018-04-09T16:15:25.145Z</updated>
    
    <content type="html"><![CDATA[<p>关于接入的步骤可以参考上一篇《支付宝APP支付服务端接入(PHP)》，详细可以看<a href="https://docs.open.alipay.com/203/105285/" target="_blank" rel="noopener">官方文档</a><br>下面就不多说了，接入开发，首先还是下载官方的sdk,然后进行调用。<br><a id="more"></a><br>实现方法<br>手机网站支付请求示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public <span class="function"><span class="keyword">function</span> <span class="title">alipay</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        require_once(<span class="string">"alipay/wappay/service/AlipayTradeService.php"</span>);</span><br><span class="line">        require_once(<span class="string">"alipay/wappay/buildermodel/AlipayTradeWapPayContentBuilder.php"</span>);</span><br><span class="line">        require_once(<span class="string">"alipay/config.php"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//商户订单号，商户网站订单系统中唯一订单号，必填</span></span><br><span class="line">        $out_trade_no = <span class="string">'商户订单号'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//订单名称，必填</span></span><br><span class="line">        $subject = <span class="string">'订单名称'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//付款金额，必填</span></span><br><span class="line">        $total_amount = <span class="string">'付款金额'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//商品描述，可空</span></span><br><span class="line">        $body = <span class="string">'商品描述'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//超时时间</span></span><br><span class="line">        $timeout_express=<span class="string">"1m"</span>;</span><br><span class="line"></span><br><span class="line">        $payRequestBuilder = <span class="keyword">new</span> \AlipayTradeWapPayContentBuilder();</span><br><span class="line">        $payRequestBuilder-&gt;setBody($body);</span><br><span class="line">        $payRequestBuilder-&gt;setSubject($subject);</span><br><span class="line">        $payRequestBuilder-&gt;setOutTradeNo($out_trade_no);</span><br><span class="line">        $payRequestBuilder-&gt;setTotalAmount($total_amount);</span><br><span class="line">        $payRequestBuilder-&gt;setTimeExpress($timeout_express);</span><br><span class="line"></span><br><span class="line">        $payResponse = <span class="keyword">new</span> \AlipayTradeService($config);</span><br><span class="line">        $payResponse-&gt;wapPay($payRequestBuilder,$config[<span class="string">'return_url'</span>],$config[<span class="string">'notify_url'</span>]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>调起支付宝app支付示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//由于微信浏览器屏蔽支付宝链接 官方给出跳出微信环境支付的解决方案 引入ap.js（将ap.js和pay.htm放在网站根目录）</span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span> src=<span class="string">"ap.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        $(<span class="built_in">document</span>).on(<span class="string">'click'</span>,<span class="string">'[data-role="alipay"]'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> order_id = $(<span class="keyword">this</span>).attr(<span class="string">'data-id'</span>);</span><br><span class="line">            <span class="keyword">var</span> ua = <span class="built_in">window</span>.navigator.userAgent.toLowerCase();</span><br><span class="line">            $.post(<span class="string">"&#123;:U('xxx/xxx/alipay')&#125;"</span>,&#123;<span class="attr">order_id</span>:order_id&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(res.status==<span class="literal">false</span>)&#123;</span><br><span class="line">                    $.toast(res.info);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(ua.match(<span class="regexp">/MicroMessenger/i</span>) == <span class="string">'micromessenger'</span>)&#123;<span class="comment">//判断微信浏览器</span></span><br><span class="line">                        e.preventDefault();</span><br><span class="line">                        e.stopPropagation();</span><br><span class="line">                        e.stopImmediatePropagation();</span><br><span class="line">                        _AP.pay(res);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="built_in">window</span>.location.href = res;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>回调示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">public <span class="function"><span class="keyword">function</span> <span class="title">alipay_notify</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        require_once(<span class="string">"alipay/wappay/service/AlipayTradeService.php"</span>);</span><br><span class="line">        require_once(<span class="string">"alipay/config.php"</span>);</span><br><span class="line">        $arr = $_POST;</span><br><span class="line">        $alipaySevice = <span class="keyword">new</span> \AlipayTradeService($config);</span><br><span class="line">        $alipaySevice-&gt;writeLog(var_export($_POST, <span class="literal">true</span>));</span><br><span class="line">        $result = $alipaySevice-&gt;check($arr);</span><br><span class="line">        <span class="keyword">if</span> ($result) &#123;<span class="comment">//验证成功</span></span><br><span class="line">            <span class="comment">//商户订单号</span></span><br><span class="line"></span><br><span class="line">            $out_trade_no = $_POST[<span class="string">'out_trade_no'</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//支付宝交易号</span></span><br><span class="line"></span><br><span class="line">            $trade_no = $_POST[<span class="string">'trade_no'</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//交易状态</span></span><br><span class="line">            $trade_status = $_POST[<span class="string">'trade_status'</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ($_POST[<span class="string">'trade_status'</span>] == <span class="string">'TRADE_FINISHED'</span>) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//判断该笔订单是否在商户网站中已经做过处理</span></span><br><span class="line">                <span class="comment">//如果没有做过处理，根据订单号（out_trade_no）在商户网站的订单系统中查到该笔订单的详细，并执行商户的业务程序</span></span><br><span class="line">                <span class="comment">//请务必判断请求时的total_amount与通知时获取的total_fee为一致的</span></span><br><span class="line">                <span class="comment">//如果有做过处理，不执行商户的业务程序</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//注意：</span></span><br><span class="line">                <span class="comment">//退款日期超过可退款期限后（如三个月可退款），支付宝系统发送该交易状态通知</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ($_POST[<span class="string">'trade_status'</span>] == <span class="string">'TRADE_SUCCESS'</span>) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//支付成功</span></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                * 业务逻辑</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line"></span><br><span class="line">                echo <span class="string">"success"</span>;        <span class="comment">//请不要修改或删除</span></span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//验证失败</span></span><br><span class="line">                echo <span class="string">"fail"</span>;    <span class="comment">//请不要修改或删除</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于接入的步骤可以参考上一篇《支付宝APP支付服务端接入(PHP)》，详细可以看&lt;a href=&quot;https://docs.open.alipay.com/203/105285/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt;&lt;br&gt;下面就不多说了，接入开发，首先还是下载官方的sdk,然后进行调用。&lt;br&gt;
    
    </summary>
    
    
      <category term="支付宝支付" scheme="http://yoursite.com/tags/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98/"/>
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>微信支付JSAPI(PHP)</title>
    <link href="http://yoursite.com/2018/04/07/wechat-jsapi/"/>
    <id>http://yoursite.com/2018/04/07/wechat-jsapi/</id>
    <published>2018-04-07T09:46:29.000Z</published>
    <updated>2018-04-09T16:17:15.691Z</updated>
    
    <content type="html"><![CDATA[<p>公众号支付是用户在微信中打开商户的H5页面，商户在H5页面通过调用微信支付提供的JSAPI接口调起微信支付模块完成支付。适用于微信浏览器内完成微信支付。配置参考<a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_3" target="_blank" rel="noopener">官方文档</a><br><a id="more"></a><br>实现方法<br>统一下单示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$tools = <span class="keyword">new</span> JsApiPay();</span><br><span class="line">$openId = $tools-&gt;GetOpenid();<span class="comment">//获取openid</span></span><br><span class="line">$input = <span class="keyword">new</span> WxPayUnifiedOrder();</span><br><span class="line">$input-&gt;SetBody($name);<span class="comment">//商品描述</span></span><br><span class="line">$input-&gt;SetOut_trade_no($out_trade_no);<span class="comment">//订单号</span></span><br><span class="line">$input-&gt;SetTotal_fee($amount);<span class="comment">//订单总金额，单位分</span></span><br><span class="line">$input-&gt;SetTime_start(date(<span class="string">"YmdHis"</span>));</span><br><span class="line">$input-&gt;SetTime_expire(date(<span class="string">"YmdHis"</span>, time() + <span class="number">600</span>));</span><br><span class="line">$input-&gt;SetNotify_url(<span class="string">"回调域名"</span>);</span><br><span class="line">$input-&gt;SetTrade_type(<span class="string">"JSAPI"</span>);<span class="comment">//交易类型</span></span><br><span class="line">$input-&gt;SetOpenid($openId);</span><br><span class="line">$order = WxPayApi::unifiedOrder($input);<span class="comment">//统一下单接口</span></span><br><span class="line">$jsApiParameters = $tools-&gt;GetJsApiParameters($order);</span><br></pre></td></tr></table></figure></p><p>调起微信支付示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="comment">//调用微信JS api 支付</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">jsApiCall</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        WeixinJSBridge.invoke(</span><br><span class="line">            <span class="string">'getBrandWCPayRequest'</span>,&#123;</span><br><span class="line">                <span class="string">"appId"</span>:<span class="string">"wx2421b1c4370ec43b"</span>,     <span class="comment">//公众号名称，由商户传入     </span></span><br><span class="line">                <span class="string">"timeStamp"</span>:<span class="string">"1395712654"</span>,         <span class="comment">//时间戳，自1970年以来的秒数     </span></span><br><span class="line">                <span class="string">"nonceStr"</span>:<span class="string">"e61463f8efa94090b1f366cccfbbb444"</span>, <span class="comment">//随机串     </span></span><br><span class="line">                <span class="string">"package"</span>:<span class="string">"prepay_id=u802345jgfjsdfgsdg888"</span>,     </span><br><span class="line">                <span class="string">"signType"</span>:<span class="string">"MD5"</span>,         <span class="comment">//微信签名方式：     </span></span><br><span class="line">                <span class="string">"paySign"</span>:<span class="string">"70EA570631E4BB79628FBCA90534C63FF7FADD89"</span> <span class="comment">//微信签名</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(res.err_msg == <span class="string">"get_brand_wcpay_request:ok"</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(res.err_msg == <span class="string">"get_brand_wcpay_request:ok"</span> ) &#123;&#125;     <span class="comment">// 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。 </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callpay</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> WeixinJSBridge == <span class="string">"undefined"</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>( <span class="built_in">document</span>.addEventListener )&#123;</span><br><span class="line">                <span class="built_in">document</span>.addEventListener(<span class="string">'WeixinJSBridgeReady'</span>, jsApiCall, <span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.attachEvent)&#123;</span><br><span class="line">                <span class="built_in">document</span>.attachEvent(<span class="string">'WeixinJSBridgeReady'</span>, jsApiCall);</span><br><span class="line">                <span class="built_in">document</span>.attachEvent(<span class="string">'onWeixinJSBridgeReady'</span>, jsApiCall);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            jsApiCall();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        callpay();</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>回调处理示列<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$WxPay = <span class="keyword">new</span> \WxPayResults();</span><br><span class="line">header(<span class="string">'Content-type: text/xml'</span>);</span><br><span class="line">$returnResult = $GLOBALS[<span class="string">'HTTP_RAW_POST_DATA'</span>]; <span class="comment">//接收微信发送的信息</span></span><br><span class="line">$res = $WxPay::Init($returnResult);</span><br><span class="line"><span class="keyword">if</span>(res[<span class="string">'result_code'</span>] == <span class="string">'SUCCESS'</span>)&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 业务处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">$success = array(<span class="string">'return_code'</span> =&gt; <span class="string">'SUCCESS'</span>, <span class="string">'return_msg'</span> =&gt; <span class="string">'OK'</span>);</span><br><span class="line">exit(ToXml($success));<span class="comment">//转成xml通知给微信</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;公众号支付是用户在微信中打开商户的H5页面，商户在H5页面通过调用微信支付提供的JSAPI接口调起微信支付模块完成支付。适用于微信浏览器内完成微信支付。配置参考&lt;a href=&quot;https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_3&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="微信支付" scheme="http://yoursite.com/tags/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>微信支付企业付款(PHP)</title>
    <link href="http://yoursite.com/2018/04/07/wechat-mch-pay/"/>
    <id>http://yoursite.com/2018/04/07/wechat-mch-pay/</id>
    <published>2018-04-07T08:56:01.000Z</published>
    <updated>2018-04-09T16:17:37.251Z</updated>
    
    <content type="html"><![CDATA[<p>企业付款为企业提供付款至用户零钱的能力，支持通过API接口付款，或通过微信支付商户平台（pay.weixin.qq.com）网页操作付款。配置和说明可以参考<a href="https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_1/" target="_blank" rel="noopener">官方文档</a><br><a id="more"></a><br>实现方法<br>在微信官方SDK的WxPay.Api.php添加参考代码：<br>企业向个人付款<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public <span class="function"><span class="keyword">function</span> <span class="title">mchPay</span>(<span class="params">$params</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  $url = <span class="string">"https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers"</span>;</span><br><span class="line">    <span class="comment">//检测必填参数</span></span><br><span class="line">    <span class="keyword">if</span>($params[<span class="string">"partner_trade_no"</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WxPayException(<span class="string">"企业付款申请接口中，缺少必填参数partner_trade_no！"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($params[<span class="string">"openid"</span>] == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WxPayException(<span class="string">"企业付款申请接口中，缺少必填参数openid！"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($params[<span class="string">"check_name"</span>] == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WxPayException(<span class="string">"企业付款申请接口中，缺少必填参数check_name！"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($params[<span class="string">"amount"</span>] == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WxPayException(<span class="string">"企业付款申请接口中，缺少必填参数amount！"</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($params[<span class="string">"desc"</span>] == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WxPayException(<span class="string">"企业付款申请接口中，缺少必填参数desc！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $params[<span class="string">"mch_appid"</span>] = WxPayConfig::APPID();<span class="comment">//公众账号ID</span></span><br><span class="line">    $params[<span class="string">"mchid"</span>] = WxPayConfig::MCHID();<span class="comment">//商户号</span></span><br><span class="line">    $params[<span class="string">"nonce_str"</span>] = self::getNonceStr();<span class="comment">//随机字符串</span></span><br><span class="line">    $params[<span class="string">'spbill_create_ip'</span>] = $_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">'::1'</span> ? <span class="string">'192.127.1.1'</span> : $_SERVER[<span class="string">'REMOTE_ADDR'</span>];<span class="comment">//获取IP</span></span><br><span class="line"></span><br><span class="line">    $obj = <span class="keyword">new</span> \WxPayDataBase();</span><br><span class="line">    $params[<span class="string">"sign"</span>] = $<span class="keyword">this</span>-&gt;MakeSign($params);<span class="comment">//签名</span></span><br><span class="line">    $xml = $<span class="keyword">this</span>-&gt;arrayToXml($params);</span><br><span class="line">    $response = self::postXmlCurl($xml, $url, <span class="literal">true</span>);</span><br><span class="line">    $obj-&gt;FromXml($response);</span><br><span class="line">    <span class="keyword">return</span> $obj-&gt;GetValues();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//array转xml</span></span><br><span class="line">public <span class="function"><span class="keyword">function</span> <span class="title">arrayToXml</span>(<span class="params">$arr</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $xml = <span class="string">"&lt;xml&gt;"</span>;</span><br><span class="line">    foreach ($arr <span class="keyword">as</span> $key=&gt;$val)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (is_numeric($val))</span><br><span class="line">        &#123;</span><br><span class="line">            $xml.=<span class="string">"&lt;"</span>.$key.<span class="string">"&gt;"</span>.$val.<span class="string">"&lt;/"</span>.$key.<span class="string">"&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            $xml.=<span class="string">"&lt;"</span>.$key.<span class="string">"&gt;&lt;![CDATA["</span>.$val.<span class="string">"]]&gt;&lt;/"</span>.$key.<span class="string">"&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $xml.=<span class="string">"&lt;/xml&gt;"</span>;</span><br><span class="line">    <span class="keyword">return</span> $xml;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成签名</span></span><br><span class="line">public <span class="function"><span class="keyword">function</span> <span class="title">MakeSign</span>(<span class="params">$params</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//签名步骤一：按字典序排序参数</span></span><br><span class="line">    ksort($params);</span><br><span class="line">    $string = $<span class="keyword">this</span>-&gt;ToUrlParams($params);</span><br><span class="line">    <span class="comment">//签名步骤二：在string后加入KEY</span></span><br><span class="line">    $string = $string . <span class="string">"&amp;key="</span>.WxPayConfig::KEY();</span><br><span class="line">    <span class="comment">//签名步骤三：MD5加密</span></span><br><span class="line">    $string = md5($string);</span><br><span class="line">    <span class="comment">//签名步骤四：所有字符转为大写</span></span><br><span class="line">    $result = strtoupper($string);</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="function"><span class="keyword">function</span> <span class="title">ToUrlParams</span>(<span class="params">$params</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $buff = <span class="string">""</span>;</span><br><span class="line">    foreach ($params <span class="keyword">as</span> $k =&gt; $v)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>($k != <span class="string">"sign"</span> &amp;&amp; $v != <span class="string">""</span> &amp;&amp; !is_array($v))&#123;</span><br><span class="line">            $buff .= $k . <span class="string">"="</span> . $v . <span class="string">"&amp;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $buff = trim($buff, <span class="string">"&amp;"</span>);</span><br><span class="line">    <span class="keyword">return</span> $buff;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用示例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$mchPay = <span class="keyword">new</span> \WxPayApi();  </span><br><span class="line">$amount = <span class="string">'付款金额'</span>;<span class="comment">//企业付款金额，单位“分”</span></span><br><span class="line">$desc = <span class="string">'企业付款'</span>;<span class="comment">//描述</span></span><br><span class="line">$partner_trade_no = <span class="string">'订单号'</span>;</span><br><span class="line">$openid = <span class="string">'用户oppenid'</span>;</span><br><span class="line">$params = array(</span><br><span class="line">    <span class="string">'partner_trade_no'</span> =&gt; $partner_trade_no,</span><br><span class="line">    <span class="string">'openid'</span> =&gt; $openid,</span><br><span class="line">    <span class="string">'check_name'</span> =&gt; <span class="string">'NO_CHECK'</span>,<span class="comment">//不校验姓名</span></span><br><span class="line">    <span class="string">'amount'</span> =&gt; $amount,</span><br><span class="line">    <span class="string">'desc'</span> =&gt; $desc,</span><br><span class="line">);</span><br><span class="line">$toPay = $mchPay-&gt;mchPay($params);</span><br><span class="line"><span class="keyword">if</span>($toPay[<span class="string">"return_code"</span>]==<span class="string">"SUCCESS"</span>&amp;&amp;$toPay[<span class="string">"result_code"</span>]==<span class="string">"SUCCESS"</span>)&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 业务逻辑 数据库操作</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    echo <span class="string">"付款成功"</span>; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//输出错误信息</span></span><br><span class="line">    echo $toPay[<span class="string">'err_code'</span>].$toPay[<span class="string">'err_code_des'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;企业付款为企业提供付款至用户零钱的能力，支持通过API接口付款，或通过微信支付商户平台（pay.weixin.qq.com）网页操作付款。配置和说明可以参考&lt;a href=&quot;https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_1/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;官方文档&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="微信支付" scheme="http://yoursite.com/tags/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>支付宝APP支付服务端接入(PHP)</title>
    <link href="http://yoursite.com/2018/04/07/alipay/"/>
    <id>http://yoursite.com/2018/04/07/alipay/</id>
    <published>2018-04-07T08:04:00.000Z</published>
    <updated>2018-04-09T16:16:55.333Z</updated>
    
    <content type="html"><![CDATA[<p>第一步：创建应用并获取APPID<br>要在您的应用中接入支付宝App支付能力，需要通过创建应用的方式接入蚂蚁相关接口并进行开发，在创建应用后即生成应用的标识APPID，使用支付宝账号登录开放平台后，在“我的应用”中查看APPID。<br><a id="more"></a><br>第二步：配置应用<br>添加app支付功能——&gt;签约——&gt;配置密钥<br>第三步：集成和开发<br>集成服务端SDK<br><img src="/2018/04/07/alipay/sdk.png"><br>获取PHP版资源SDK要注意开发环境最好达到官方建议的环境要求，否则集成过程中要对SDK作调整来适配环境。<br>PHP服务端SDK生成APP支付订单信息示例<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$aop = <span class="keyword">new</span> AopClient;</span><br><span class="line">$aop-&gt;gatewayUrl = <span class="string">"https://openapi.alipay.com/gateway.do"</span>;</span><br><span class="line">$aop-&gt;appId = <span class="string">"app_id"</span>;</span><br><span class="line">$aop-&gt;rsaPrivateKey = '请填写开发者私钥去头去尾去回车，一行字符串';</span><br><span class="line">$aop-&gt;format = <span class="string">"json"</span>;</span><br><span class="line">$aop-&gt;charset = <span class="string">"UTF-8"</span>;</span><br><span class="line">$aop-&gt;signType = <span class="string">"RSA2"</span>;</span><br><span class="line">$aop-&gt;alipayrsaPublicKey = '请填写支付宝公钥，一行字符串';</span><br><span class="line"><span class="comment">//实例化具体API对应的request类,类名称和接口名称对应,当前调用接口名称：alipay.trade.app.pay</span></span><br><span class="line">$request = <span class="keyword">new</span> AlipayTradeAppPayRequest();</span><br><span class="line"><span class="comment">//SDK已经封装掉了公共参数，这里只需要传入业务参数</span></span><br><span class="line">$bizcontent = <span class="string">"&#123;\"body\":\"我是测试数据\","</span> </span><br><span class="line">                . <span class="string">"\"subject\": \"App支付测试\","</span></span><br><span class="line">                . <span class="string">"\"out_trade_no\": \"20170125test01\","</span></span><br><span class="line">                . <span class="string">"\"timeout_express\": \"30m\","</span> </span><br><span class="line">                . <span class="string">"\"total_amount\": \"0.01\","</span></span><br><span class="line">                . <span class="string">"\"product_code\":\"QUICK_MSECURITY_PAY\""</span></span><br><span class="line">                . <span class="string">"&#125;"</span>;</span><br><span class="line">$request-&gt;setNotifyUrl(<span class="string">"商户外网可以访问的异步地址"</span>);</span><br><span class="line">$request-&gt;setBizContent($bizcontent);</span><br><span class="line"><span class="comment">//这里和普通的接口调用不同，使用的是sdkExecute</span></span><br><span class="line">$response = $aop-&gt;sdkExecute($request);</span><br><span class="line"><span class="comment">//htmlspecialchars是为了输出到页面时防止被浏览器将关键参数html转义，实际打印到日志以及http传输不会有这个问题</span></span><br><span class="line"><span class="function">echo <span class="title">htmlspecialchars</span><span class="params">($response)</span></span>;<span class="comment">//就是orderString 可以直接给客户端请求，无需再做处理。</span></span><br></pre></td></tr></table></figure></p><p>PHP服务端验证异步通知信息参数示例<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$aop = <span class="keyword">new</span> AopClient;</span><br><span class="line">$aop-&gt;alipayrsaPublicKey = '请填写支付宝公钥，一行字符串';</span><br><span class="line">$flag = $aop-&gt;rsaCheckV1($_POST, <span class="literal">NULL</span>, <span class="string">"RSA2"</span>);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;第一步：创建应用并获取APPID&lt;br&gt;要在您的应用中接入支付宝App支付能力，需要通过创建应用的方式接入蚂蚁相关接口并进行开发，在创建应用后即生成应用的标识APPID，使用支付宝账号登录开放平台后，在“我的应用”中查看APPID。&lt;br&gt;
    
    </summary>
    
    
      <category term="支付宝支付" scheme="http://yoursite.com/tags/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98/"/>
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>微信APP支付服务端接入(PHP)</title>
    <link href="http://yoursite.com/2018/04/07/wechat/"/>
    <id>http://yoursite.com/2018/04/07/wechat/</id>
    <published>2018-04-07T08:01:16.000Z</published>
    <updated>2018-04-09T16:17:57.942Z</updated>
    
    <content type="html"><![CDATA[<p>第一步：申请微信APP支付<br>微信开放平台是商户APP接入微信支付开放接口的申请入口，通过此平台可申请微信APP支付。<br><a id="more"></a><br>第二步：配置商户支付密钥<br>微信商户平台是微信支付相关的商户功能集合，登录微信商户平台后按以下步骤操作：<br>1.点击帐户中心——操作证书——安装安全控件——安装操作证书（要验证手机号码）<br>2.点击帐户中心——API安全——设置API密钥——确认——新密钥——手机验证码——登录密码<br>第三步：集成和开发<br>集成服务端SDK<br><img src="/2018/04/07/wechat/sdk.png"><br>微信APP支付统一下单示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$input = <span class="keyword">new</span> WxPayUnifiedOrder();</span><br><span class="line">$input-&gt;SetBody(<span class="string">"test"</span>); <span class="comment">//商品描述</span></span><br><span class="line">$input-&gt;SetOut_trade_no(<span class="string">"商户订单号"</span>);</span><br><span class="line">$input-&gt;SetTotal_fee(<span class="string">"1"</span>); <span class="comment">//订单总金额，注意单位为分</span></span><br><span class="line">$input-&gt;SetTime_start(date(<span class="string">"YmdHis"</span>));</span><br><span class="line">$input-&gt;SetTime_expire(date(<span class="string">"YmdHis"</span>, time() + <span class="number">600</span>));</span><br><span class="line">$input-&gt;SetNotify_url(<span class="string">"商户外网可以访问的异步地址"</span>);</span><br><span class="line">$input-&gt;SetTrade_type(<span class="string">"APP"</span>);</span><br><span class="line">$order = WxPayApi::unifiedOrder($input); <span class="comment">//调用统一下单接口</span></span><br></pre></td></tr></table></figure></p><p>调起支付<br>商户服务器生成支付订单，先调用【统一下单API】生成预付单，获取到prepay_id后将参数再次签名传输给APP发起支付。以下是调起微信支付的关键代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$order_data = $WxPayApi-&gt;GetAppParameters($order); <span class="comment">//调起支付所需的请求参数</span></span><br></pre></td></tr></table></figure></p><p>GetAppParameters()是外加的代码，微信SDK中没有这个方法，下面是在微信SDK中代码APP支付补充部分。<br>在WxPay.Api.php中补充代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 获取App支付的参数</span></span><br><span class="line"><span class="comment"> * @param array $UnifiedOrderResult 统一支付接口返回的数据</span></span><br><span class="line"><span class="comment"> * @throws WxPayException</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @return $parameters</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="function"><span class="keyword">function</span> <span class="title">GetAppParameters</span>(<span class="params">$UnifiedOrderResult</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!array_key_exists(<span class="string">"appid"</span>, $UnifiedOrderResult)</span><br><span class="line">        || !array_key_exists(<span class="string">"prepay_id"</span>, $UnifiedOrderResult)</span><br><span class="line">        || $UnifiedOrderResult[<span class="string">'prepay_id'</span>] == <span class="string">""</span></span><br><span class="line">        || !array_key_exists(<span class="string">"mch_id"</span>, $UnifiedOrderResult)</span><br><span class="line">        || $UnifiedOrderResult[<span class="string">'mch_id'</span>] == <span class="string">""</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WxPayException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $app = <span class="keyword">new</span> WxPayAppPay();</span><br><span class="line">    $app-&gt;SetAppid($UnifiedOrderResult[<span class="string">"appid"</span>]);</span><br><span class="line">    $app-&gt;SetPrepayId($UnifiedOrderResult[<span class="string">"prepay_id"</span>]);</span><br><span class="line">    $app-&gt;SetPartnerId($UnifiedOrderResult[<span class="string">'mch_id'</span>]);</span><br><span class="line">    $timeStamp = time();</span><br><span class="line">    $app-&gt;SetTimeStamp(<span class="string">"$timeStamp"</span>);</span><br><span class="line">    $app-&gt;SetNonceStr(WxPayApi::getNonceStr());</span><br><span class="line">    $app-&gt;SetPackage(<span class="string">"Sign=WXPay"</span>);</span><br><span class="line">    $app-&gt;SetPaySign($app-&gt;MakeSign());</span><br><span class="line">    $parameters = $app-&gt;GetValues();</span><br><span class="line">    <span class="keyword">return</span> $parameters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>在WxPay.Data.php中补充代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 提交App输入对象</span></span><br><span class="line"><span class="comment"> * @author lin</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WxPayAppPay</span> <span class="keyword">extends</span> <span class="title">WxPayDataBase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置微信分配的公众账号ID</span></span><br><span class="line"><span class="comment">     * @param string $value</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">SetAppid</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;values[<span class="string">'appid'</span>] = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置预支付交易会话ID</span></span><br><span class="line"><span class="comment">     * @param string $value</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">SetPrepayId</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;values[<span class="string">'prepayid'</span>] = $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置商户号ID</span></span><br><span class="line"><span class="comment">     * @param string $value</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">SetPartnerId</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;values[<span class="string">'partnerid'</span>] = $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置支付时间戳</span></span><br><span class="line"><span class="comment">     * @param string $value</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">SetTimeStamp</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;values[<span class="string">'timestamp'</span>] = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机字符串</span></span><br><span class="line"><span class="comment">     * @param string $value</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">SetNonceStr</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;values[<span class="string">'noncestr'</span>] = $value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置订单详情扩展字符串</span></span><br><span class="line"><span class="comment">     * @param string $value</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">SetPackage</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;values[<span class="string">'package'</span>] = $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置签名方式</span></span><br><span class="line"><span class="comment">     * @param string $value</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">SetPaySign</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>-&gt;values[<span class="string">'sign'</span>] = $value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>回调处理的示列<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$WxPay = <span class="keyword">new</span> \WxPayResults();</span><br><span class="line">header(<span class="string">'Content-type: text/xml'</span>);</span><br><span class="line">$returnResult = $GLOBALS[<span class="string">'HTTP_RAW_POST_DATA'</span>]; <span class="comment">//接收微信发送的信息</span></span><br><span class="line">$res = $WxPay::Init($returnResult);</span><br><span class="line"><span class="keyword">if</span>(res[<span class="string">'result_code'</span>] == <span class="string">'SUCCESS'</span>)&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 业务处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">$success = <span class="string">"&lt;xml&gt;&lt;return_code&gt;&lt;![CDATA[SUCCESS]]&gt;&lt;/return_code&gt;&lt;return_msg&gt;&lt;![CDATA[OK]]&gt;&lt;/return_msg&gt;&lt;/xml&gt;"</span>;</span><br><span class="line">exit($success);<span class="comment">//回调结果通知</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;第一步：申请微信APP支付&lt;br&gt;微信开放平台是商户APP接入微信支付开放接口的申请入口，通过此平台可申请微信APP支付。&lt;br&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="微信支付" scheme="http://yoursite.com/tags/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98/"/>
    
  </entry>
  
  <entry>
    <title>Vue+tp5简单列表操作</title>
    <link href="http://yoursite.com/2018/03/06/vtpro/"/>
    <id>http://yoursite.com/2018/03/06/vtpro/</id>
    <published>2018-03-06T15:58:36.000Z</published>
    <updated>2018-04-09T16:49:48.779Z</updated>
    
    <content type="html"><![CDATA[<p>前段时间，初次使用前端框架Vue和ThinkPHP5.1，于是就简单结合起来，用Vue+axios发送请求，TP5处理接口数据。<br>这里Vue、axios和TP5等等的安装就不多说了，按照官方文档来就ok了。<br><a id="more"></a><br>Vue部分，在main.js中引入axios,qs来帮助处理数据，接口请求的时候会遇到跨域问题<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import axios from 'axios'</span><br><span class="line">import Qs from 'qs'</span><br><span class="line">Vue.prototype.$axios = axios;</span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">var axios_instance = axios.create(&#123;</span><br><span class="line">transformRequest: [function (data) &#123;</span><br><span class="line">data = Qs.stringify(data);</span><br><span class="line"><span class="keyword">return</span> data;</span><br><span class="line">&#125;],</span><br><span class="line"><span class="comment">//Post请求传递参数时，需要在请求头加上item.ContentType = "application/x-www-form-urlencoded";</span></span><br><span class="line">headers:&#123;'Content-Type':'application/x-www-form-urlencoded'&#125;</span><br><span class="line">&#125;)</span><br><span class="line">Vue.prototype.$axios = axios_instance;</span><br></pre></td></tr></table></figure></p><p>PHP部分后端响应头进行设置<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定允许其他域名访问</span></span><br><span class="line">header(<span class="string">"Access-Control-Allow-Origin:*"</span>);</span><br><span class="line"><span class="comment">// 响应类型</span></span><br><span class="line">header(<span class="string">"Access-Control-Allow-Methods:GET, POST, PATCH, PUT, DELETE"</span>);</span><br><span class="line"><span class="comment">// 响应头设置</span></span><br><span class="line">header(<span class="string">"Access-Control-Allow-Headers:x-requested-with,content-type"</span>);</span><br></pre></td></tr></table></figure></p><p>解决了跨域问题后，接下来就能通过接口请求和数据处理了。</p><p>在Vue的/config/dev.env.js 设置 API_HOST<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">'use strict'</span><br><span class="line">const merge = require('webpack-merge')</span><br><span class="line">const prodEnv = require('./prod.env')</span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span>.exports = merge(prodEnv, &#123;</span><br><span class="line">NODE_ENV: '"development"',</span><br><span class="line">API_HOST:'"http://127.0.0.1/tp5/"'</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>下面是一个简单的列表，包含简单的增删改查，查看单条数据等功能<br><img src="/2018/03/06/vtpro/list.png"><br>列表部分代码<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">template</span>&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>="<span class="title">list</span>-<span class="title">table</span>"&gt;</span></span><br><span class="line"><span class="class">        &lt;h1&gt;<span class="title">TODO</span>-<span class="title">LIST</span>&lt;/h1&gt;</span></span><br><span class="line"><span class="class">        &lt;form&gt;</span></span><br><span class="line"><span class="class">            姓名：&lt;input type="text" v-model="nickname"/&gt; &#123;</span>&#123;nickname&#125;&#125;</span><br><span class="line">            &lt;br/&gt;</span><br><span class="line">            年龄：&lt;input type=<span class="string">"text"</span> v-model=<span class="string">"age"</span>/&gt;  &#123;&#123;age&#125;&#125;</span><br><span class="line">            &lt;br/&gt;</span><br><span class="line">            &lt;span style=<span class="string">"color:red"</span> v-<span class="keyword">if</span>=<span class="string">"!isAge"</span>&gt;年龄必须是数字&lt;/span&gt;</span><br><span class="line">            &lt;br/&gt;</span><br><span class="line">            &lt;br/&gt;</span><br><span class="line">            &lt;button type=<span class="string">"button"</span> @click=<span class="string">"addList"</span>&gt;添加&lt;/button&gt;</span><br><span class="line">            &lt;button type=<span class="string">"button"</span> @click=<span class="string">"init()"</span>&gt;重置&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;table border=<span class="string">"1"</span> cellspacing=<span class="string">"0"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">                &lt;th&gt;序号&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;年龄&lt;/th&gt;</span><br><span class="line">                &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">            &lt;/thead&gt;</span><br><span class="line">            &lt;tr v-<span class="keyword">for</span>=<span class="string">"(data,index) in  list"</span>&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123;index+<span class="number">1</span>&#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123;data.nickname&#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123;data.age&#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    &lt;button @click=<span class="string">"detail(index)"</span>&gt;查看详情&lt;/button&gt;</span><br><span class="line">                    &lt;button @click=<span class="string">"delList(index)"</span>&gt;删除&lt;/button&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td colspan=<span class="string">"2"</span> style=<span class="string">"text-align: center"</span>&gt;总年龄：&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&#123;&#123;sumAge&#125;&#125;&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;&lt;button @click=<span class="string">"controlList"</span>&gt;清空/还原&lt;/button&gt;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/<span class="keyword">template</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name:<span class="string">"TODOList"</span></span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">//姓名</span></span><br><span class="line">            nickname:<span class="string">""</span>,</span><br><span class="line">            <span class="comment">//年龄</span></span><br><span class="line">            age:<span class="string">""</span>,</span><br><span class="line">            <span class="comment">//age是数字</span></span><br><span class="line">            isAge:<span class="literal">true</span>,</span><br><span class="line">            <span class="built_in">list</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created()&#123;</span><br><span class="line">        <span class="keyword">this</span>.getList()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取列表数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    getList: function () &#123;</span><br><span class="line">        let $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>.$axios.get(process.env.API_HOST)</span><br><span class="line">        .then(function(response)&#123;</span><br><span class="line">        $<span class="keyword">this</span>.<span class="built_in">list</span> = response.data;</span><br><span class="line">        console.<span class="built_in">log</span>(response.data);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="keyword">catch</span>(function (error) &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 新增列表数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    addList:function()&#123;</span><br><span class="line">        let $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.isAge)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($<span class="keyword">this</span>.nickname &amp;&amp; $<span class="keyword">this</span>.age)&#123;</span><br><span class="line">            $this.$axios.get(process.env.API_HOST + 'index/index/addList',&#123;</span><br><span class="line">                params: &#123;</span><br><span class="line">                    nickname: $<span class="keyword">this</span>.nickname,</span><br><span class="line">                    age: $<span class="keyword">this</span>.age</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).then(function (response) &#123;</span><br><span class="line">                console.<span class="built_in">log</span>(response.data);</span><br><span class="line">                $<span class="keyword">this</span>.<span class="built_in">list</span>.push(&#123;</span><br><span class="line">                    nickname:response.data.nickname,</span><br><span class="line">                    age:response.data.age</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;).<span class="keyword">catch</span>(function (error) &#123;</span><br><span class="line">                console.<span class="built_in">log</span>(error);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 删除列表数据</span></span><br><span class="line"><span class="comment">    * @param index  list键值</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    delList:function(index)&#123;</span><br><span class="line">        let $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line">        if(confirm('确定要删除吗'))&#123;</span><br><span class="line">            <span class="keyword">if</span>($<span class="keyword">this</span>.<span class="built_in">list</span>[index] != undefined)&#123;</span><br><span class="line">                $this.$axios.post(process.env.API_HOST + 'index/index/delList',&#123;</span><br><span class="line">                    nickname: $<span class="keyword">this</span>.<span class="built_in">list</span>[index].nickname</span><br><span class="line">                    &#125;).then(function (response) &#123;</span><br><span class="line">                        if(response.data=='操作成功')&#123;</span><br><span class="line">                            $<span class="keyword">this</span>.<span class="built_in">list</span>.splice(index,<span class="number">1</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;).<span class="keyword">catch</span>(function (error) &#123;</span><br><span class="line">                    console.<span class="built_in">log</span>(error);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 清空或还原列表数据</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    controlList:function()&#123;</span><br><span class="line">        if(confirm('确定要执行此操作吗'))&#123;</span><br><span class="line">            this.$axios.post(process.env.API_HOST + 'index/index/controlList').then(response=&gt;&#123;</span><br><span class="line">                if(response.data=='')&#123;</span><br><span class="line">                    <span class="keyword">this</span>.<span class="built_in">list</span>.splice(<span class="number">0</span>,<span class="keyword">this</span>.<span class="built_in">list</span>.length);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">for</span> (var i in response.data) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.<span class="built_in">list</span>.push(&#123;</span><br><span class="line">                        nickname:response.data[i].nickname,</span><br><span class="line">                        age:response.data[i].age</span><br><span class="line">                    &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).<span class="keyword">catch</span>(function (error) &#123;</span><br><span class="line">                console.<span class="built_in">log</span>(error);</span><br><span class="line">            &#125;);;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    detail:function(index)&#123;</span><br><span class="line">        this.$router.push(&#123;path:'/detail',query: &#123;nickname: this.list[index].nickname&#125;&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 初始化输入</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    init:function()&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickname = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">this</span>.age = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">this</span>.isAge = <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 检测数字</span></span><br><span class="line"><span class="comment">    * @param theObj       要检测的字符串</span></span><br><span class="line"><span class="comment">    * @returns &#123;boolean&#125;  是数字放回true  不是返回false</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    checkNumber:function(theObj) &#123;</span><br><span class="line">        var reg = /^[<span class="number">0</span><span class="number">-9</span>]+$/;</span><br><span class="line">        <span class="keyword">if</span>(reg.test(theObj))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed:&#123;</span><br><span class="line">        sumAge:function()&#123;</span><br><span class="line">            var ages = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (var i in <span class="keyword">this</span>.<span class="built_in">list</span>) &#123;</span><br><span class="line">                ages += Number(<span class="keyword">this</span>.<span class="built_in">list</span>[i].age);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ages;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch:&#123;</span><br><span class="line">        age:&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 监听age的变化</span></span><br><span class="line"><span class="comment">            * @param newValue</span></span><br><span class="line"><span class="comment">            * @param oldValue</span></span><br><span class="line"><span class="comment">            * @returns &#123;boolean&#125;</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            handler(newValue, oldValue)&#123;</span><br><span class="line">                <span class="keyword">if</span>(newValue == <span class="string">""</span>)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.isAge = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                var res = <span class="keyword">this</span>.checkNumber(newValue);</span><br><span class="line">                <span class="keyword">if</span>(res)&#123;</span><br><span class="line">                    <span class="keyword">this</span>.isAge = <span class="literal">true</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">this</span>.isAge = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .<span class="built_in">list</span>-table&#123;</span><br><span class="line">        width: <span class="number">100</span>%;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="built_in">list</span>-table table&#123;</span><br><span class="line">        margin: <span class="number">0</span> <span class="keyword">auto</span>;</span><br><span class="line">        width: <span class="number">500</span>px;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="built_in">list</span>-table table th&#123;</span><br><span class="line">        font-size: <span class="number">28</span>px;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="built_in">list</span>-table table td&#123;</span><br><span class="line">        padding: <span class="number">5</span>px <span class="number">0</span>;</span><br><span class="line">        font-size: <span class="number">20</span>px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></p><img src="/2018/03/06/vtpro/detail.png"><p>详情部分代码<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">template</span>&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>="<span class="title">list</span>-<span class="title">table</span>"&gt;</span></span><br><span class="line">    &lt;h1&gt;&#123;&#123;msg&#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;table border=<span class="string">"1"</span> cellspacing=<span class="string">"0"</span>&gt;</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">        &lt;th&gt;用户UID&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;姓名&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;年龄&lt;/th&gt;</span><br><span class="line">    &lt;/thead&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123;uid&#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123;nickname&#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123;age&#125;&#125;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td colspan=<span class="string">"2"</span>&gt;信息介绍&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            &lt;button type=<span class="string">"button"</span> @click=<span class="string">"OpenModal"</span>&gt;添加/编辑信息&lt;/button&gt;</span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td colspan=<span class="string">"3"</span> v-<span class="keyword">if</span>=<span class="string">"info"</span>&gt;&#123;&#123;info&#125;&#125;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">    &lt;router-link to=<span class="string">"/list"</span>&gt;返回&lt;/router-link&gt;</span><br><span class="line">        &lt;div class=<span class="string">"open-box"</span> v-<span class="keyword">if</span>=<span class="string">"OpenShow"</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">"open-box-content"</span>&gt;</span><br><span class="line">                &lt;h3&gt;编辑信息&lt;/h3&gt;</span><br><span class="line">                &lt;p&gt;请输入您的个人信息&lt;/p&gt;</span><br><span class="line">                &lt;textarea v-model=<span class="string">"info"</span>&gt;&#123;&#123;info&#125;&#125;&lt;/textarea&gt;</span><br><span class="line">                &lt;div class=<span class="string">"open-box-btn"</span>&gt;</span><br><span class="line">                    &lt;div class=<span class="string">"open-box-btn-left"</span>&gt;</span><br><span class="line">                        &lt;button @click=<span class="string">"addinfo"</span>&gt;保存&lt;/button&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=<span class="string">"open-box-btn-right"</span>&gt;</span><br><span class="line">                        &lt;button @click=<span class="string">"ColseModal"</span>&gt;关闭&lt;/button&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">         &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/<span class="keyword">template</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: 'Detail',</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">        msg: '信息详情',</span><br><span class="line">        uid:'',</span><br><span class="line">        <span class="comment">//姓名</span></span><br><span class="line">        nickname:<span class="string">""</span>,</span><br><span class="line">        <span class="comment">//年龄</span></span><br><span class="line">        age:<span class="string">""</span>,</span><br><span class="line">        OpenShow: <span class="literal">false</span>,</span><br><span class="line">        info:<span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created()&#123;</span><br><span class="line">        <span class="keyword">this</span>.getinfo()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取信息</span></span><br><span class="line"><span class="comment">    */</span>    </span><br><span class="line">    getinfo: function () &#123;</span><br><span class="line">        let $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line">        this.$axios.get(process.env.API_HOST+'index/index/getInfo',&#123;</span><br><span class="line">        params:&#123;nickname:<span class="keyword">this</span>.$route.query.nickname&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(function(response)&#123;</span><br><span class="line">        $<span class="keyword">this</span>.nickname = response.data.nickname</span><br><span class="line">        $<span class="keyword">this</span>.age = response.data.age</span><br><span class="line">        $<span class="keyword">this</span>.uid = response.data.uid</span><br><span class="line">        $<span class="keyword">this</span>.info = response.data.info</span><br><span class="line">        console.<span class="built_in">log</span>(response.data);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="keyword">catch</span>(function (error) &#123;</span><br><span class="line">        console.<span class="built_in">log</span>(error);</span><br><span class="line">    &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编辑信息</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    addinfo: function()&#123;</span><br><span class="line">        this.$axios.post(process.env.API_HOST+'index/index/addInfo',&#123;</span><br><span class="line">        info:<span class="keyword">this</span>.info,</span><br><span class="line">        uid:<span class="keyword">this</span>.uid</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(response=&gt;&#123;</span><br><span class="line">        alert(response.data)</span><br><span class="line">        <span class="keyword">this</span>.OpenShow = !<span class="keyword">this</span>.OpenShow</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="keyword">catch</span>(function(error)&#123;</span><br><span class="line">        console.<span class="built_in">log</span>(error);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    OpenModal() &#123;</span><br><span class="line">        <span class="keyword">this</span>.OpenShow = !<span class="keyword">this</span>.OpenShow</span><br><span class="line">    &#125;,</span><br><span class="line">    ColseModal() &#123;</span><br><span class="line">        <span class="keyword">this</span>.OpenShow = !<span class="keyword">this</span>.OpenShow</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.<span class="built_in">list</span>-table&#123;</span><br><span class="line">width: <span class="number">100</span>%;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="built_in">list</span>-table table&#123;</span><br><span class="line">margin: <span class="number">0</span> <span class="keyword">auto</span>;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/*样式部分省略*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*弹窗样式*/</span></span><br><span class="line">.open-box &#123;</span><br><span class="line">position: fixed;</span><br><span class="line">background: rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">width: <span class="number">100</span>%;</span><br><span class="line">height: <span class="number">100</span>%;</span><br><span class="line">left: <span class="number">0</span>;</span><br><span class="line">top: <span class="number">0</span>;</span><br><span class="line">z-index: <span class="number">100</span>;</span><br><span class="line">color: <span class="meta">#fff;</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">/*样式部分省略*/</span></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></p><p>TP5中相应的代码做数据库处理<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取列表数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> function <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $res = model('Member')-&gt;getUserList();</span><br><span class="line">    <span class="keyword">return</span> $res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 新增列表数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> function <span class="title">addList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $nickname=Input('nickname');</span><br><span class="line">    $age=Input('age',0,'floatval');</span><br><span class="line">    $res = model('Member')-&gt;save([</span><br><span class="line">        'nickname'=&gt;$nickname,</span><br><span class="line">        'age'=&gt;$age,</span><br><span class="line">        'status'=&gt;1</span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">if</span>($res)&#123;</span><br><span class="line">        $data=['nickname'=&gt;$nickname,'age'=&gt;$age];</span><br><span class="line">        $data = json_encode($data);</span><br><span class="line">        <span class="keyword">return</span> $data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 删除列表数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> function <span class="title">delList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $nickname=Input('nickname');</span><br><span class="line">    model('Member')-&gt;save(['status'=&gt;-1],['nickname'=&gt;$nickname]);</span><br><span class="line">    return '操作成功';</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 清空还原列表数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> function <span class="title">controlList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    if(!model('Member')-&gt;where(['status'=&gt;1])-&gt;count())&#123;</span><br><span class="line">        model('Member')-&gt;save(['status'=&gt;1],['status'=&gt;-1]);</span><br><span class="line">        $res = model('Member')-&gt;getUserList();</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        model('Member')-&gt;save(['status'=&gt;-1],['status'=&gt;1]);</span><br><span class="line">        return '';</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> function <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $nickname=Input('nickname');</span><br><span class="line">    $info = model('Member')-&gt;where(['nickname'=&gt;$nickname])-&gt;find();</span><br><span class="line">    <span class="keyword">return</span> $info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 编辑信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> function <span class="title">addInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $info = Input('info');</span><br><span class="line">    $uid = Input('uid');</span><br><span class="line">    $res = model('Member')-&gt;save(['info'=&gt;$info],['uid'=&gt;$uid]);</span><br><span class="line">    <span class="keyword">if</span>($res)&#123;</span><br><span class="line">        return '编辑成功';</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>数据表结构<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">--</span><br><span class="line">-- 表的结构 `list_member`</span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS `list_member` (</span><br><span class="line">  `uid` <span class="keyword">int</span>(<span class="number">11</span>) NOT <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `nickname` varchar(<span class="number">10</span>) NOT <span class="literal">NULL</span>,</span><br><span class="line">  `age` <span class="keyword">int</span>(<span class="number">11</span>) NOT <span class="literal">NULL</span>,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) NOT <span class="literal">NULL</span>,</span><br><span class="line">  `info` varchar(<span class="number">200</span>) NOT <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY KEY (`uid`)</span><br><span class="line">) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=<span class="number">1</span> ;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前段时间，初次使用前端框架Vue和ThinkPHP5.1，于是就简单结合起来，用Vue+axios发送请求，TP5处理接口数据。&lt;br&gt;这里Vue、axios和TP5等等的安装就不多说了，按照官方文档来就ok了。&lt;br&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="Vue" scheme="http://yoursite.com/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>shadowsocks</title>
    <link href="http://yoursite.com/2018/02/28/shadowsocks/"/>
    <id>http://yoursite.com/2018/02/28/shadowsocks/</id>
    <published>2018-02-27T16:30:31.000Z</published>
    <updated>2018-03-01T16:18:42.136Z</updated>
    
    <content type="html"><![CDATA[<p>VPS服务器超简单搭建shadowsocks 方法<br>vultr服务器购买：<a href="https://www.vultr.com/" target="_blank" rel="noopener">https://www.vultr.com/</a><br>安装Xshell，安装完成后新建会话（Alt+N），协议选择SSH，主机填写之前的IP Address，端口号选择22。<br><a id="more"></a><br>VPS可以先升级<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y update</span><br></pre></td></tr></table></figure></p><p>有些VPS 没有wget<br>这种要先装<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget</span><br></pre></td></tr></table></figure></p><p>输入以下命令：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>wget --no-check-certificate https:<span class="comment">//raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh</span></span><br><span class="line"><span class="number">2.</span>chmod +x shadowsocks.sh</span><br><span class="line"><span class="number">3.</span>./shadowsocks.sh <span class="number">2</span>&gt;&amp;<span class="number">1</span> | tee shadowsocks.<span class="built_in">log</span></span><br></pre></td></tr></table></figure></p><p>第一行是下载命令，下载东西，第二行是修改权限，第三行是安装命令<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">配置：</span><br><span class="line">密码：（默认是teddysun.com）</span><br><span class="line">端口：默认是<span class="number">8989</span></span><br><span class="line">然后按任意键安装，退出按 Ctrl+c</span><br></pre></td></tr></table></figure></p><p>安装完成会有一个配置<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Congratulations, shadowsocks install completed!Your Server IP:  ***** VPS的IP地址Your Server Port:  *****  你刚才设置的端口Your Password:  ****  你刚才设置的密码Your Local IP:  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> Your Local Port:  <span class="number">1080</span> Your Encryption Method:  aes<span class="number">-256</span>-cfb Welcome to visit:https:<span class="comment">//teddysun.com/342.htmlEnjoy it!</span></span><br></pre></td></tr></table></figure></p><p>然后就可以用这些东西</p><p>VPS主机一键安装Google TCP BBR加速<br>因为VPS架构系统的不同，我们很多软件的安装、部署也是具有局限性的。比如搬瓦工以前都是OpenVZ架构，是不可以安装类似锐速、Google TCP BBR来给服务器加速的。在上周的时候，我们都有看到新增KVM架构方案，虽然还处于测试就阶段，但是也是可以购买的，数据中心在洛杉矶QN，最为主要的是KVM架构，我们可以安装Google TCP BBR工具。</p><p>在这篇文章中，将利用teddysun分享的一键Google TCP BBR安装工具脚本（<a href="https://teddysun.com/489.html）来部署到搬瓦工KVM" target="_blank" rel="noopener">https://teddysun.com/489.html）来部署到搬瓦工KVM</a> VPS中，看看速度是否提高。这样我们用来建站或者其他用途的速度应该还是可以提升的。</p><p>第一、系统支持<br>我们系统需要是CentOS 6+，Debian 7+，Ubuntu 12+，除了OpenVZ架构之外都支持，比如常规的KVM和XEN。</p><p>第二、一键脚本安装<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https:<span class="comment">//github.com/teddysun/across/raw/master/bbr.sh</span></span><br><span class="line">chmod +x bbr.sh</span><br><span class="line">./bbr.sh</span><br></pre></td></tr></table></figure></p><p>自动安装，然后最后提示我们需要重启生效。</p><p>第三、检查BBR启动<br>1、检查核心<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure></p><p>检查内核是不是4.10，检测后看到的是”4.10.5-1.el6.elrepo.x86_64”。</p><p>2、执行后返回<br>“net.ipv4.tcp_available_congestion_control = bbr cubic reno”<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br></pre></td></tr></table></figure></p><p>3、执行后返回<br>“net.ipv4.tcp_congestion_control = bbr”<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_congestion_control</span><br></pre></td></tr></table></figure></p><p>4、查看返回值”net.core.default_qdisc = fq”<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.core.default_qdisc</span><br></pre></td></tr></table></figure></p><p>5、看到有BBR信息。说明安装成功了。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep bbr</span><br></pre></td></tr></table></figure></p><p>这样，在安装完毕BBR之后，我们去建站等用途的时候，应该是速度有提高的。</p><h3 id="shadowsocks下载"><a href="#shadowsocks下载" class="headerlink" title="shadowsocks下载"></a>shadowsocks下载</h3><h4 id="Android-Google-Play"><a href="#Android-Google-Play" class="headerlink" title="Android  Google Play:"></a>Android  Google Play:</h4><p><a href="http://ossfiles.fyvps.com/ssclient/shadowsocks-nightly-4.2.5.apk" target="_blank" rel="noopener">http://ossfiles.fyvps.com/ssclient/shadowsocks-nightly-4.2.5.apk</a></p><h4 id="iOS-App-Store"><a href="#iOS-App-Store" class="headerlink" title="iOS  App Store:"></a>iOS  App Store:</h4><p>Shadowrocket   黑洞  Detour   Shadowing    Shadowing    Shadowfish (复制任意一个到应用商店尝试搜索下载)</p><h4 id="Mac-OS-X-系统："><a href="#Mac-OS-X-系统：" class="headerlink" title="Mac OS X 系统："></a>Mac OS X 系统：</h4><p><a href="http://ossfiles.fyvps.com/ssclient/ShadowsocksX-NG-1.4.zip" target="_blank" rel="noopener">http://ossfiles.fyvps.com/ssclient/ShadowsocksX-NG-1.4.zip</a></p><h4 id="For-Windows"><a href="#For-Windows" class="headerlink" title="For Windows:"></a>For Windows:</h4><p><a href="http://ossfiles.fyvps.com/ssclient/Shadowsocks-4.0.6.zip" target="_blank" rel="noopener">http://ossfiles.fyvps.com/ssclient/Shadowsocks-4.0.6.zip</a></p><h4 id="Linux-客户端-shadowsocks-qt5-版本"><a href="#Linux-客户端-shadowsocks-qt5-版本" class="headerlink" title="Linux 客户端 ,shadowsocks-qt5 版本:"></a>Linux 客户端 ,shadowsocks-qt5 版本:</h4><p><a href="https://github.com/shadowsocks/shadowsocks-qt5/wiki" target="_blank" rel="noopener">https://github.com/shadowsocks/shadowsocks-qt5/wiki</a></p><h3 id="备用方式"><a href="#备用方式" class="headerlink" title="备用方式"></a>备用方式</h3><h4 id="脚本功能"><a href="#脚本功能" class="headerlink" title="脚本功能"></a>脚本功能</h4><p> 自定义端口号和密码</p><p> 全过程静默安装，不会打扰用户，你所要做的就是去听一首音乐或者去喝杯咖啡</p><p> 一次只允许运行一个shadowsocks进程，脚本会自动检测原来已经运行的进程并杀死</p><p> 安装防火墙并开放需要的端口</p><h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><p>下载脚本<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O ss.sh http:<span class="comment">//45.32.195.77/file/ss.sh</span></span><br></pre></td></tr></table></figure></p><p>执行脚本<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash ss.sh</span><br></pre></td></tr></table></figure></p><p>设置端口号并回车，直接回车是设置为1225<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please enter PORT(1225 default):</span><br></pre></td></tr></table></figure></p><p>设置密码并回车，直接回车是设置为123456<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please enter PASSWORD(123456 default):</span><br></pre></td></tr></table></figure></p><p>等待一会……就完成了（初次执行约2-5min）</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;VPS服务器超简单搭建shadowsocks 方法&lt;br&gt;vultr服务器购买：&lt;a href=&quot;https://www.vultr.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.vultr.com/&lt;/a&gt;&lt;br&gt;安装Xshell，安装完成后新建会话（Alt+N），协议选择SSH，主机填写之前的IP Address，端口号选择22。&lt;br&gt;
    
    </summary>
    
    
      <category term="shadowsocks" scheme="http://yoursite.com/tags/shadowsocks/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7</title>
    <link href="http://yoursite.com/2018/02/27/centos/"/>
    <id>http://yoursite.com/2018/02/27/centos/</id>
    <published>2018-02-27T14:28:52.000Z</published>
    <updated>2018-03-01T16:18:42.136Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS 7 安装配置LAMP服务器方法(Apache+PHP+MariaDB)<br>摘要: CentOS 7 安装配置LAMP服务器方法(Apache+PHP+MariaDB)，CentOS 7后Mysql改为MariaDB<br><a id="more"></a><br>准备篇：</p><p>一、配置防火墙，开启80端口、3306端口</p><p>CentOS 7 默认使用的是firewall作为防火墙，这里改为iptables防火墙。</p><p>1、关闭firewall：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service #停止firewall </span><br><span class="line">systemctl disable firewalld.service #禁止firewall开机启动</span><br></pre></td></tr></table></figure></p><p>2、安装iptables防火墙</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install iptables-services #安装 </span><br><span class="line">vi /etc/sysconfig/iptables #编辑防火墙配置文件</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Firewall configuration written by system-config-firewall </span><br><span class="line"># Manual customization of <span class="keyword">this</span> file is <span class="keyword">not</span> recommended. </span><br><span class="line">*filter </span><br><span class="line">:INPUT ACCEPT [<span class="number">0</span>:<span class="number">0</span>] </span><br><span class="line">:FORWARD ACCEPT [<span class="number">0</span>:<span class="number">0</span>] </span><br><span class="line">:OUTPUT ACCEPT [<span class="number">0</span>:<span class="number">0</span>] </span><br><span class="line">-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT </span><br><span class="line">-A INPUT -p icmp -j ACCEPT </span><br><span class="line">-A INPUT -i lo -j ACCEPT </span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="number">22</span> -j ACCEPT </span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="number">80</span> -j ACCEPT </span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="number">3306</span> -j ACCEPT </span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited </span><br><span class="line">-A FORWARD -j REJECT --reject-with icmp-host-prohibited </span><br><span class="line">COMMIT </span><br><span class="line">:wq! #保存退出</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart iptables.service #最后重启防火墙使配置生效 </span><br><span class="line">systemctl enable iptables.service #设置防火墙开机启动</span><br></pre></td></tr></table></figure><p>二、关闭SELINUX<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/selinux/config</span><br><span class="line">#SELINUX=enforcing #注释掉</span><br><span class="line">#SELINUXTYPE=targeted #注释掉</span><br><span class="line">SELINUX=disabled #增加</span><br><span class="line">:wq! #保存退出</span><br><span class="line">setenforce <span class="number">0</span> #使配置立即生效</span><br></pre></td></tr></table></figure></p><p>安装篇：</p><p>一、安装Apache<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd #根据提示，输入Y安装即可成功安装</span><br><span class="line">systemctl start httpd.service #启动apache</span><br><span class="line">systemctl stop httpd.service #停止apache</span><br><span class="line">systemctl restart httpd.service #重启apache</span><br><span class="line">systemctl enable httpd.service #设置apache开机启动</span><br></pre></td></tr></table></figure></p><p>二、安装MariaDB</p><p>CentOS 7 中，已经使用MariaDB替代了MySQL数据库</p><p>1、安装MariaDB<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install mariadb mariadb-server #询问是否要安装，输入Y即可自动安装,直到安装完成</span><br><span class="line">systemctl start mariadb.service #启动MariaDB</span><br><span class="line">systemctl stop mariadb.service #停止MariaDB</span><br><span class="line">systemctl restart mariadb.service #重启MariaDB</span><br><span class="line">systemctl enable mariadb.service #设置开机启动</span><br><span class="line">cp /usr/share/mysql/my-huge.cnf /etc/my.cnf #拷贝配置文件（注意：如果/etc目录下面默认有一个my.cnf，直接覆盖即可）</span><br></pre></td></tr></table></figure></p><p>2、为root账户设置密码<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure></p><p>回车，根据提示输入Y</p><p>输入2次密码，回车</p><p>根据提示一路输入Y</p><p>最后出现：Thanks for using MySQL!</p><p>MySql密码设置完成，重新启动 MySQL：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mariadb.service #重启MariaDB</span><br></pre></td></tr></table></figure></p><p>三、安装PHP</p><p>1、安装PHP 和 php-devel工具 方便日后使用 phpize 做扩展编译<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install php php-devel #根据提示输入Y直到安装完成</span><br></pre></td></tr></table></figure></p><p>2、安装PHP组件，使PHP支持 MariaDB<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install php-mysql php-gd libjpeg* php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-bcmath php-mhash</span><br></pre></td></tr></table></figure></p><p>这里选择以上安装包进行安装，根据提示输入Y回车<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mariadb.service #重启MariaDB</span><br><span class="line"></span><br><span class="line">systemctl restart httpd.service #重启apache</span><br></pre></td></tr></table></figure></p><p>注意：apache默认的程序目录是/var/www/html</p><p>权限设置：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R apache:apache  /var/www/html</span><br></pre></td></tr></table></figure></p><p>至此，CentOS 7.0安装配置LAMP服务器(Apache+PHP+MariaDB)教程完成！<br>原文链接：<a href="https://my.oschina.net/sallency/blog/467647" target="_blank" rel="noopener">https://my.oschina.net/sallency/blog/467647</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CentOS 7 安装配置LAMP服务器方法(Apache+PHP+MariaDB)&lt;br&gt;摘要: CentOS 7 安装配置LAMP服务器方法(Apache+PHP+MariaDB)，CentOS 7后Mysql改为MariaDB&lt;br&gt;
    
    </summary>
    
    
      <category term="CentOS" scheme="http://yoursite.com/tags/CentOS/"/>
    
  </entry>
  
</feed>
